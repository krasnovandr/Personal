<div ng-controller="RoundWinnerVoteController" class="container">
  <div class="row">
    <div class="col-md-6">
      <h4>Победившее предложение</h4>

    </div>
    <div class="col-md-6">
      <button class="btn btn-success pull-right" ng-click="openSuggestionModal(suggestionEnum.add,node)" tooltip-placement="left" uib-tooltip="Внести предложение по добавлению нового блока">
        <span class="glyphicon glyphicon-plus"></span>
      </button>
      <button class="btn btn-warning pull-right" ng-click="closeLevelVote(node)" tooltip-placement="left" uib-tooltip="Больше нет предложений">
        <span class="glyphicon 	glyphicon glyphicon-folder-close"></span>
      </button>
    </div>

  </div>

  <div class="row" ng-hide="">
    <table class="table table-condensed">
      <tbody>
        <tr>
          <td class="col-md-12">
            <div ng-repeat="node in winner.SuggestedNodes" class="col-md-3">
              <div class="panel"
                   ng-class="{'panel-success':node.CurrentSuggestion.Type == suggestionEnum.add,
                                                'panel-info'   :node.CurrentSuggestion.Type == suggestionEnum.edit,
                                                'panel-danger' :node.CurrentSuggestion.Type == suggestionEnum.remove,
                                                'panel-default':node.CurrentSuggestion == null
                                               }">
                <div class="panel-heading" ng-if="node.CurrentSuggestion == null">
                  <button class="btn btn-danger" ng-click="openSuggestionModal(suggestionEnum.remove,node)" tooltip-placement="top" uib-tooltip="Внести предложение по удалению блока">
                    <span class="glyphicon glyphicon-remove-circle"></span>
                  </button>
                  <button class="btn btn-warning" ng-click="openSuggestionModal(suggestionEnum.edit,node)" tooltip-placement="top" uib-tooltip="Внести предложение по редактированию блока">
                    <span class="glyphicon glyphicon-pencil"></span>
                  </button>
                  <button class="btn btn-info pull-right" ng-click="goToRoundWinnerVote()" tooltip-placement="top" uib-tooltip="Просмотреть историю блока">
                    <span class="glyphicon glyphicon-book"></span>
                  </button>
                </div>
                <div class="panel-heading" ng-if="node.CurrentSuggestion != null">
                  <button ng-click="suggestionVote(voteEnum.up,node)" tooltip-placement="top" uib-tooltip="Проглосовать за предложение">
                    <span class="glyphicon glyphicon-thumbs-up"></span>
                  </button>
                  <button ng-click="openVoteUsersModal(node.CurrentSuggestion.VotesUp)">
                    <span class="text-danger">{{node.CurrentSuggestion.VotesUp.length}}</span>
                  </button>
                  <button ng-click="suggestionVote(voteEnum.down,node)" tooltip-placement="top" uib-tooltip="Проглосовать против предложения">
                    <span class="glyphicon glyphicon-thumbs-down"></span>
                  </button>
                  <button ng-click="openVoteUsersModal(node.CurrentSuggestion.VotesDown)">
                    <span class="text-danger">{{node.CurrentSuggestion.VotesDown.length}}</span>
                  </button>
                  <button class="btn btn-info pull-right" ng-click="viewComments(node)" tooltip-placement="top" uib-tooltip="Просмотреть коментарии">
                    <span class="glyphicon glyphicon-comment"></span>
                  </button>
                </div>
                <div class="panel-body">

                  <div ng-if="node.CurrentSuggestion.Type == suggestionEnum.edit">
                    <textarea readonly cols="30" rows="5">{{node.CurrentSuggestion.Value}}</textarea>
                  </div>
                  <textarea readonly cols="30" rows="5">{{node.Name}}</textarea>
                </div>
              </div>
            </div>
          <td>
        </tr>
      </tbody>
    </table>
  </div>



  <h4>Предложения остальных участников</h4>
  <div class="row">
    <table class="table table-striped">
      <tbody ui:sortable ng:model="members">
        <tr ng-repeat="member in members" ng-show="$index != 0" class="warning">
          <td class="info">
            <div class="panel panel-default">
              <div class="panel-heading">
                <a href="/#/Users/{{member.Id}} ">
                  <span>{{member.FirstName}}</span>
                  <span>{{member.LastName}}</span>
                </a>
              </div>
              <div class="panel-body">
                <img ng-src="{{member.AvatarFilePath}}" width="80" height="80" />
              </div>
            </div>
          <td>
          <td class="col-md-9">
            <div ng-repeat="node in member.SuggestedNodes">
              <div class="col-md-4">
                <div class="panel panel-default ">
                  <div class="panel-heading">
                    <span>{{$index + 1}}</span>
                  </div>
                  <div class="panel-body">
                    <textarea readonly cols="30" rows="5">{{node.Name}}</textarea>
                  </div>
                </div>
              </div>
            </div>
          <td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="container" ng-show="showComments">
    <div class="row chat-window col-xs-5 col-md-3" id="chat_window_1" style="margin-left:10px;">
      <div class="col-xs-12 col-md-12">
        <div class="panel panel-default" id="draggablePanelList">
          <div class="panel-heading top-bar">
            <div class="col-md-8 col-xs-8">
              <h3 class="panel-title"><span class="glyphicon glyphicon-comment"></span> {{commentsToNode.Name}}</h3>
            </div>
            <div class="col-md-4 col-xs-4" style="text-align: right;">
              <button type="button" class="close" ng-click="closeComments()">&times;</button>
            </div>
          </div>

          <div class="panel-body msg_container_base" my-scroll>
            <div ng-repeat="comment in comments">


              <div class="row msg_container base_sent" ng-if="comment.CommentBy.Id == logState.Id">
                <div class="col-md-10 col-xs-10">
                  <div class="messages msg_sent">
                    <p>
                      {{comment.Value}}
                    </p>
                    <time>{{comment.Date | ctime | date:'HH:mm:ss '}}</time>
                  </div>
                </div>
                <div class="col-md-2 col-xs-2 avatar">
                  <img ng-src="{{comment.CommentBy.AvatarFilePath}}" class=" img-responsive ">
                </div>
              </div>

              <div class="row msg_container base_receive" ng-if="comment.CommentBy.Id != logState.Id">
                <div class="col-md-2 col-xs-2 avatar">
                  <img ng-src="{{comment.CommentBy.AvatarFilePath}}" class=" img-responsive ">
                </div>
                <div class="col-md-10 col-xs-10">
                  <div class="messages msg_receive">
                    <p>
                      {{comment.Value}}
                    </p>
                    <time>{{comment.Date | ctime | date:'HH:mm:ss '}}</time>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel-footer">
            <div class="input-group">
              <input id="btn-input" type="text" ng-model="comment" class="form-control input-sm" placeholder="Write your message here..." />
              <span class="input-group-btn">
                <button class="btn btn-primary btn-sm" id="btn-chat" ng-click="addComment(comment)">Send</button>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
